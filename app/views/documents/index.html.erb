<% groups = @documents.sort_by { |h| h.year }.reverse.group_by { |m| m.year } %>
<% salnet = DocLine.where(category: :salaire_net_paye ).group_by{ |m| m.data_entry_period.year } %>

<div class="container">
  <h1 class="m-5">Mes documents</h1>
  <% groups.each do |group| %>
    <div class="section">
      <div class="entete d-flex justify-content-between align-items-center">
        <div class="m-0">
          <p class="m-0" style="font-size: 16px;">Année</p>
          <h2 class="text-info"><%= group[0] %></h2>
        </div>
        <div class="text-center">
          <% sal1 = 0 %>
          <% salnet[group[0]].each { |sal| sal1 +=  sal.amount } %>
          <p style="font-size: 11px;" class="m-0">Revenu annuel<strong class="ml-5"><%= sal1.round.to_s.reverse.gsub(/...(?=.)/,'\& ').reverse %> €</strong></p>
          <div class="progress">
            <div class="progress-bar bg-success m-0" role="progressbar" style="width: <%= (100 * group[1].size)/(12) %>%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <em class="w-100 text-center" style="font-size: 11px;"><%= group[1].size %> fiches sur 12</em>
        </div>
        <div>
          <%= link_to doc_lines_path do %>
            <div class="d-flex justify-content-between btn btn-primary">
              Mon tableau de bord
              <i class="ml-3 fas fa-chevron-right"></i>
            </div>
          <% end %>
        </div>
        </div>
      <div class="cards" style="position: relative;">
        <% group[1].each do |document| %>
          <div class="card" style="background-image: url('<%= cl_image_path(document.photo.key, format: :jpg) %>');">
            <div class="multi-button">
              <a href="#" class="fas fa-pen"></a>
              <a href="#" class="fas fa-share-alt"></a>
              <a href="#" class="fas fa-trash"></a>
            </div>
            <div class="card-body">
              <h5 class="card-text pt-5 pb-4"><%= document.name %></h5>
              <p><i class="pr-4 far fa-building"></i><%= document.entreprise %></p>
              <p><i class="pr-4 fas fa-euro-sign"></i><%= DocLine.salaire_brut.find_by(document: document).amount.round(2) %></p>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

