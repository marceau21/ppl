
<% groups = @documents.sort_by { |h| h.year }.reverse.group_by { |m| m.year } %>
<% salnet = DocLine.where(category: :salaire_net_paye ).group_by{ |m| m.data_entry_period.year } %>

<div class="container">
  <div class="button-add">
    <i class="fas fa-plus-circle", id="buttonModal", data-toggle="modal", aria-haspopup= "true", aria-expanded= "false", data-target="#add_document"></i>
  </div>
  <div class="modal fade" id="add_document" tabindex="-1" role="dialog" aria-labelledby="Ajouter un bulletin" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ajouter un bulletin</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <%= simple_form_for (Document.new) do |form| %>
            <%= form.input :photo, as: :file %>
            <div class="row">
              <div class="col">
                <%= form.input :year, as: :date,  discard_day: true, discard_month: true %>
              </div>
              <div class="col">
                <%= form.input :month, as: :date,  discard_day: true, discard_year: true  %>
              </div>
            </div>

            <%= form.button :submit, 'Ajouter' , class:'btn btn-primary w-100 mb-2'%>
        <% end %>
        </div>
      </div>
    </div>
  </div>


  <h1 class="m-5">Mes documents</h1>

  <div class="filtre p-1 text-center m-5 sticky-top shadow-lg" style="top:15vh;">
    <%= form_tag documents_path, method: :get do %>
      <div class="d-flex justify-content-center align-items-center mx-5">
        <%= text_field_tag :query,
        params[:query],
        class: "form-control",
        placeholder: "Ann√©e, mois, entreprise, etc..."
        %>
        <%= button_tag type: 'submit', class: "btn btn-primary m-1 text-white" do %>
          <i class="fa fa-search" aria-hidden="true"></i>
        <% end %>
        <%= link_to 'üòè',  documents_path ,class:'btn btn-primary m-1 text-white' %>
      </div>

    <% end %>
  </div>

  <% groups.each do |group| %>
    <div class="section">
      <div class="entete d-flex justify-content-between align-items-center">
        <div class="m-0">
          <p class="m-0" style="font-size: 16px;">Ann√©e</p>
          <h2 class="text-info"><%= group[0] %></h2>
        </div>
        <div class="text-center">
          <% sal1 = 0 %>
          <% salnet[group[0]].each { |sal| sal1 +=  sal.amount } %>
          <p style="font-size: 11px;" class="m-0">Revenu annuel<strong class="ml-5"><%= sal1.round.to_s.reverse.gsub(/...(?=.)/,'\& ').reverse %> ‚Ç¨</strong></p>
          <div class="progress">
            <div class="progress-bar bg-success m-0" role="progressbar" style="width: <%= (100 * group[1].size)/(12) %>%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
          <em class="w-100 text-center" style="font-size: 11px;"><%= group[1].size %> fiches sur 12</em>
        </div>
        <div>
          <%= link_to doc_lines_path do %>
            <div class="d-flex justify-content-between btn btn-primary">
              Mon tableau de bord
              <i class="ml-3 fas fa-chevron-right"></i>
            </div>
          <% end %>
        </div>
        </div>
      <div class="cards" style="position: relative;">
        <% group[1].each do |document| %>
            <div class="card" style="background-image: url('<%= cl_image_path(document.photo.key, format: :jpg) %>');">
              <div class="multi-button">
                <a href="mailto:<%= current_user.email %>" class="fas fa-share-alt"></a>
                <a href="<%= cl_image_path(document.photo.key) %>" class="fas fa-print" target="_blank"></a>
              </div>
              <div class="card-body">
                <%= link_to document_path(document) do %>
                  <div>
                    <h5 class="card-text pt-5 pb-4"><%= document.name %></h5>
                    <p><i class="pr-4 far fa-building"></i><%= document.entreprise %></p>
                    <p><i class="pr-4 fas fa-euro-sign"></i><%= DocLine.salaire_brut.find_by(document: document).amount.round(2) %></p>
                  </div>
                <% end %>
              </div>
            </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
